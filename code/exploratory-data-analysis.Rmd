---
title: "California COVID-19 Sex Demographic Analysis"
author: "Bowie Lam"
date: "12/25/2020"
output: rmarkdown::github_document
urlcolor: blue
---

## Contents:

+ [Contents](#contents)
+ [Introduction](#introduction)
+ [Setting Up](#setting-up)
+ [Observing Imported Data](#observing-imported-data)
+ [Cleaning Data](#cleaning-data)
+ [Exploring Data](#exploring-data)
+ [Plotting Data](#plotting-data)

## Introduction

For this mini-project, I want to observe:

1. the trend of COVID-19 cases overtime for the male and female sexes, and
2. any discrepancies in cases between both sexes

The below tasks are not intended to provide extensive knowledge into the subject matter, rather they simply showcase a glimpse into the general picture of the data. The observational texts that I provide for each task are meant to be rudimentary. I may conduct further research/analysis into this data set, but for now I merely intend to acquire a (very) brief look into the data.

Thank you to [California Open Data](https://data.ca.gov/) for the data. The direct link to the particular data set used and its dictionary can be found [here](https://data.ca.gov/dataset/covid-19-cases).

## Setting Up

``` {r} 
# load packages
library(ggplot2)
library(dplyr, warn.conflicts = FALSE)
library(here)
```

```{r}
# import data
df <- read.csv(here("raw_data", "case_demographics_sex.csv"), na.strings = c("", ".", "NA", " ", "None"))
head(df)
```

## Observing Imported Data

```{r}
# structure of data set
str(df)
```

```{r}
# view the different factors of `sex`
df$sex %>% unique()
```

```{r}
# view the count of each unique `sex`
df %>% group_by(sex) %>% count()
```

## Cleaning Data

```{r}
# add a 'month' column
df$month <-as.numeric(substr(df$date, 6, 7))

# add a 'day' column
df$day <-as.numeric(substr(df$date, 9, 10))
```

```{r}
# remove the following characteristics: 
# 'Transgender' and 'Unknown' from the 'sex' column; 
# 'November' from the 'month' column
df <- df %>% filter(sex != "Transgender", sex != "Unknown", month != 11)

# remove unneeded column
df$date <- NULL
df$case_percent <- NULL
df$deaths <- NULL
df$deaths_percent <- NULL
df$ca_percent <- NULL

# rename 'totalpositive2' column
colnames(df)[names(df) == "totalpositive2"] <- "total_positive"

# arrange by 'day', then arrange by 'month' (note: important for when diff() is used later on)
df <- df %>% arrange(day) %>% arrange(month)

head(df)
```

## Exploring Data 
### (+ continuation of any necessary data cleansing/manipulations)

```{r}
# explore a particular month of the data frame e.g. where 'month' is '4'
april <- df %>% filter(month == 4)

april
```

Notice that there are duplicate rows in the `april` data frame e.g. where month = 4 and day = 10. 

Create a function:

+ to remove duplicate rows
+ to double check for duplicates

```{r}
#' @title Duplicate Row Remover
#' @description removes duplicated rows from a data frame
#' @param dataframe is a table or two-dimensional array-like structure/object
#' @return a data frame that no longer has duplicate rows

remove_dup <- function(dataframe) {
  return(dataframe[!duplicated(dataframe), ])
}
```

```{r}
#' @title Duplicate Row Checker
#' @description double checks that are no duplicate rows in the data frame
#' @param dataframe is a table or two-dimensional array-like structure/object
#' @return a character/string message indicating if there are any duplicates in the data frame

check_for_dups <- function(dataframe) {
  len = dataframe %>% group_by(day) %>% count() %>% pull(n) %>% unique() %>% length()
  if (len != 1) {
    print("Oh, no! There are duplicates in this dataset! :( ")
  } else {
    print("Yay! There are no duplicates in this dataset! :) ")
  }
}
```

Test the function `remove_dup()`.

```{r}
# this data frame has duplicate rows
female_4 <- april %>% filter(sex == "Female")

# this data frame does not have duplicate rows
female_4_cleaned <- remove_dup(female_4)

check_for_dups(female_4)
check_for_dups(female_4_cleaned)
```

Remove duplicate rows from the entire `df` data frame using `remove_dup()`.

```{r}
# apply 'remove_dup()' to the data frame
df <- remove_dup(df)
head(df)
```

## Plotting Data

### Task 1

**Task 1A:** Plot in one graph the total number of positive cases for the first available month in the data set for all sexes.

```{r}
# first available 'month' is '4'
ggplot(data = df %>% filter(month == 4), 
       aes(x = day, y = total_positive, color = sex, group = sex)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = seq(min(df$day), max(df$day), 2)) +
  labs(title = "Trend of cases for the month of April", x = "Day of the Month", y = "Number of Positive Cases") +
  theme_minimal() +
  theme(plot.title = element_text(size = 15, face = "bold", hjust = 0.5))
```

**Task 1B:** Plot in one graph the total number of positive cases for the last available month in the data set for all sexes.

```{r}
# last available 'month' is '10'
ggplot(data = df %>% filter(month == 10), 
       aes(x = day, y = total_positive, color = sex, group = sex)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = seq(min(df$day), max(df$day), 2)) +
  labs(title = "Trend of cases for the month of October", x = "Day of the Month", y = "Number of Positive Cases") +
  theme_minimal() +
  theme(plot.title = element_text(size = 15, face = "bold", hjust = 0.5))
```

**Task 1 Observations:** Upon first look at both graphs, it's clear that there is a difference in the number of total cases between sexes when comparing the first month, April, to the last month, October. In Task 1A, the graph displays a similar increase in the number of positive cases between males and females; however, in October, that gap has widened to the point where it's more than obvious that females are testing positive more often than males.

### Task 2

**Task 2A:** Create a data frame for all sexes for individual analysis.

```{r}
# data frame where 'sex' is 'Female'
females_df <- df %>% filter(sex == "Female")

# data frame where 'sex' is 'Male'
males_df <- df %>% filter(sex == "Male")
```

**Task 2B:** Plot in one graph the number of cases for each month for the female sex.

```{r}
# displays the trend of cases for each month for 'Female'
options(scipen = 5)
ggplot(data = females_df, 
       aes(x = day, y = total_positive, color = as.factor(month), group = month)) +
  geom_line() +
  labs(title = "Trend of cases for each month", subtitle = "for Females", x = "Day of the Month", y = "Number of Positive Cases") +
  scale_x_continuous(breaks = seq(min(df$day), max(df$day), 2)) +
  theme_minimal() +
  theme(plot.title = element_text(size = 15, face = "bold", hjust = 0.5),
        plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5)) +
  scale_colour_discrete("Month")
```

**Task 2C:** Plot in one graph the number of cases for each month for the male sex.

```{r}
# displays the trend of cases for each month for 'Male'
options(scipen = 5)
ggplot(data = males_df, 
       aes(x = day, y = total_positive, color = as.factor(month), group = month)) +
  geom_line() +
  labs(title = "Trend of cases for each month", subtitle = "for Males", x = "Day of the Month", y = "Number of Positive Cases") +
  scale_x_continuous(breaks = seq(min(df$day), max(df$day), 2)) +
  theme_minimal() +
  theme(plot.title = element_text(size = 15, face = "bold", hjust = 0.5), 
        plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5)) +
  scale_colour_discrete("Month")
```

**Task 2 Observations:** For both sexes, it appears they share similar trends in the number of positive cases for each month. Besides that, there is not much useful information that these two graphs can provide.

### Task 3

**Task 3A:** Use the `diff()` function to find the difference in the number of cases from one day to the next.

Note: I separated `df` into different sex data frames, `females_df` and `males_df`, because if `diff()` is used on `df` where the rows alternate between `Male` and `Female`, the `difference` column produced will be incorrect. Thus, in this section I:
1. separate the main dataframe by `sex`
2. compute `diff()` on each dataframe
3. bind, using `rbind()`, the two data frames and reassign it to the main dataframe, `df`

```{r}
# add a 'difference' column to `females_df` dataframe
females_df$difference <- c(0, diff(females_df$total_positive))
females_df
```

```{r}
# add a 'difference' column to `males_df` dataframe
males_df$difference <- c(0, diff(males_df$total_positive))
males_df
```

**Task 3B:** Plot in one graph the fluctuation in cases between days for each month for the female sex.

```{r}
# plot `difference` in cases between days for each month for `Female`
ggplot(data = females_df, 
       aes(x = day, y = difference, color = as.factor(month), group = month)) +
  geom_line() +
  labs(title = "Fluctuations in Positive Cases On a Daily Basis", subtitle = "for Females", x = "Day of the Month", y = "Difference") +
  theme_minimal() +
  theme(plot.title = element_text(size = 15, face = "bold", hjust = 0.5), 
        plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5)) +
  scale_colour_discrete("Month")
```

**Task 3C:** Plot in one graph the fluctuation in cases between days for each month for the male sex.

```{r}
# plot `difference` in cases between days for each month for `Male`
ggplot(data = males_df, 
       aes(x = day, y = difference, color = as.factor(month), group = month)) +
  geom_line() +
  labs(title = "Fluctuations in Positive Cases On a Daily Basis", subtitle = "for Males", x = "Day of the Month", y = "Difference") +
  theme_minimal() +
  theme(plot.title = element_text(size = 15, face = "bold", hjust = 0.5), 
        plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5)) +
  scale_colour_discrete("Month")
```

**Task 3 Observations:** In both graphs for females and males, the months of July and August appear to containing the highest differences among all months. This may indicate a summer spike where people quarantined less than when the pandemic first started in the earlier months. This could be due to many reasons, such as adaptation to the new norm, thus resulting in people taking the pandemic less seriously.

### Task 4

**Task 4A:** Combine `females_df` and `males_df` into `df`.

```{r}
# combine `females_df` and `males_df` and reassign to `df` dataframe
df <- rbind(females_df, males_df)
```

**Task 4B:** Plot in one graph the difference in the number of cases for the first available month in the data set for all sexes.

```{r}
# first available 'month' is '4'
ggplot(data = df %>% filter(month == 4), 
       aes(x = day, y = difference, color = sex, group = sex)) +
  geom_line() +
  geom_point() +
  labs(title = "Fluctuations in Positive Cases On a Daily Basis", subtitle = "in the month of April", x = "Day of the Month", y = "Difference") +
  scale_x_continuous(breaks = seq(min(df$day), max(df$day), 2)) +
  theme_minimal() +
  theme(plot.title = element_text(size = 15, face = "bold", hjust = 0.5), 
        plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5))
```

**Task 4C:** Plot in one graph the difference in the number of cases for the last available month in the data set for all sexes.

```{r}
# last available 'month' is '10'
ggplot(data = df %>% filter(month == 10), 
       aes(x = day, y = difference, color = sex, group = sex)) +
  geom_line() +
  geom_point() +
  labs(title = "Fluctuations in Positive Cases On a Daily Basis", subtitle = "in the month of April", x = "Day of the Month", y = "Difference") +
  scale_x_continuous(breaks = seq(min(df$day), max(df$day), 2)) +
  theme_minimal() +
  theme(plot.title = element_text(size = 15, face = "bold", hjust = 0.5), 
        plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5))
```

**Task 4 Observations:** Although there are some instances where one sex had a larger difference than the other, both experienced very similar fluctuations in positive cases, whether that be in April or October. However, it does appear that female have larger differences than males more often. Similar to Task 3, this may indicate a larger problem in society that's resulting in the disproportionatlity.


